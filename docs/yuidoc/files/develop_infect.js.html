<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>develop\infect.js - vAnalyze.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="vAnalyze.js" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.0.1</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                            <li><a href="#api-methods">Methods</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/Infection.html">Infection</a></li>
                                <li><a href="../classes/Object.html">Object</a></li>
                            </ul>
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/vAnalyze.html">vAnalyze</a></li>
                            </ul>
                
                            <ul id="api-methods" class="apis methods">
                                    <li><a href="../classes/Infection.html">Infection</a></li>
                                    <li><a href="../classes/Object.html">Object</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: develop\infect.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 * Real-time code analysis and debugging, accessible both within code and from the console.
 *
 * @module vAnalyze
 * @class Object
 */
(function() {
    /*
     * Recursively get prototype that a property is attached to.
     * @returns the prototype that actually owns the method being called.
     **/
    function getOrigin(that, property) {
        if(!that) {
            return &#x27;Object&#x27;;
        }
        if(that.hasOwnProperty(property)) {
            return that;
        }
        return getOrigin(that.__proto__, property); //ToDo: double check that this isn&#x27;t depreciated.
    }

    Infection.prototype = infect;
    function Infection(that, dummy) {
        this.that = that; //Proper chaining.
        this.dummy = dummy || false; //Is it a fake infection?


        this.properties = {};
        this.__ignore__ =  true;
    }

    /*
     * Loop through any created object and get all methods attached to it.
     * If I run into an attached property (through a prototype) that I&#x27;ve already seen or stored elsewhere,
     * that should be a dead giveaway that the &#x27;elsewhere&#x27; is a prototype of this object.
     * ToDo: This method should take an options object, not a set of parameters.
     *
     **/
    var globalIgnore = { //ToDo: this should be abstracted someplace better.
        properties: {
            toString: true
        },
        constructors: [
            Number,
            String,
            Boolean
        ]
    };

    /*
     * Builds and adds infection properties to an object.
     * @returns Infection - true or false based on whether or not the infection was successful.
     **/
    function buildInfection(that) {
        var __infection__;


        //Dummy infections.
        if(that === undefined ||
            that === null ||
            !Object.isExtensible(that) ||
            that.__ignore__) {
            return new Infection(that, true);
        }

        //Proper primitive exposure.
        if(that instanceof Number || that instanceof String || that instanceof Boolean) {
            return new Infection(that.valueOf(), true);
        }

        //Otherwise, continue.
        __infection__ = new Infection(that);
        //We use defineProperty to keep our addition from being enumerated on in existing code.
        Object.defineProperty(that, &#x27;__infection__&#x27;, { value : __infection__, enumerable: false});
        return __infection__;
    }

    /**
     * vAnalyze entry point, attached to Object.prototype.
     * Call to turn any object into a Host and return that Host&#x27;s Infection
     * Can be called multiple times on already infected objects without side-effects.
     * Can be called on primitive types.
     *
     * @method infect
     * @param options: An object with options about how infections should be created.
     * @returns Infection - An object with properties about the Host
     * @todo: flesh out options.
     */
    function infect(options) {
        var infection;

        if (!this.__infection__) {
            infection = buildInfection(this);
        } else {
            return this.__infection__; //For method chaining.
        }

        if(!infection.dummy) {
            for (var p in this) {
                if (!globalIgnore.properties[p]) {
                    var properHost = this;
                    if (!this.hasOwnProperty(p)) {
                        properHost = getOrigin(this.__proto__, p);
                    }

                    //Don&#x27;t die on null/undefined.
                    if(properHost[p] !== null &amp;&amp; properHost[p] !== undefined) {
                        properHost[p] = properHost[p].infect().wrap();
                    }
                    properHost.infect().prop(p);
                }
            }
        }

        /**
         * Object returned from calling &#x60;&#x60;&#x60;infect&#x60;&#x60;&#x60; on a Host.
         * Serves as the base for most other vAnalyze functionality.
         *
         * Example creation:
         * &#x60;&#x60;&#x60;javascript
         * var myObj = {x:5, y:[10, 12]};
         * var infection = myObj.infect();
         * &#x60;&#x60;&#x60;
         *
         * Because &#x60;&#x60;&#x60;infect&#x60;&#x60;&#x60; can be called safely on already infected objects,
         * this type of storage will in practice be largely unecessary.
         *
         * @class Infection
         */
        return infection;
    }


    //------------------------Attach--------------------
    Object.defineProperty(Object.prototype, &#x27;infect&#x27;, {value: infect, enumerable:false });
    Object.prototype.infect.__ignore__ = true;

}());
    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
